{
  "title": "VSCode で TypeScript が auto import する対象を理解していなかった",
  "source": "---\ncreatedAt: 2025-12-11T10:57:21+09:00\nupdatedAt: 2025-12-11T12:06:13+09:00\ntags:\n  - scribble\n---\nCtrl + Space を押すと、書きかけの変数名や型名、関数名を良い感じに補完してくれるし、必要に応じて import 文も追加してくれて便利、くらいの認識でいたら、不可解な挙動に悩まされたのでメモ。\n\nあるプロジェクトで、dependencies に指定したパッケージから export されたシンボルが補完候補に出てこなくなった。\n\n- さっきまでは出ていたような気がする\n- ビルドは通るのでおそらく tsconfig の設定は合っていてい、あくまで IDE の問題\n- 食い合わせ？の悪いパッケージのインストールしたのかと思って dependencies を増減させてみたが、特定できず\n- むしろ dependencies の数を減らすと補完として出現するようになるが、増やすと出なくなる\n\n## 原因\n\nコマンドパレットから `Open TS Server Log` を実行してみると\n\n```\nAutoImportProviderProject: attempted to add more than 10 dependencies. Aborting.\n```\n\nとある。確かに、このログが出るときは補完が効かない、出ていないときは補完が効く。実際に dependencies の数にも一致していた。dependencies が 10 を超えると、パッケージが export するシンボルは auto import の対象から外れるもよう。\n\n## 頭の整理\n\n原因が見えてきて、なんじゃこの仕様？　と思ったが、そもそもわたしに「補完」についての基本的な理解が欠けていたことに気づいた。\n\nまず素朴に考えるなら、補完はカーソルが当たっているコード上でのスコープで参照できるシンボルを出すのが基本。\nTypeScript であれば、\n\n- グローバルスコープのシンボル\n- そのファイル内のシンボル\n- そのファイル内で import したシンボル\n\nあたりがまずは出てほしい。\nその意味では auto import という機能は「おまけ」に過ぎない。\nおまけの機能は、そもそも探索空間が膨大だから、どこかで割り切りをする必要がある。その恣意的なラインとして 10 というマジックナンバーがあるのは不思議ではない。\n\n実装を確認したわけではなくあくまで観測した挙動レベルでの整理だと、探索の範囲は\n\n- ローカルファイル（プロジェクト）のシンボルは全て見る\n- dependencies に書いたパッケージが 10 以下であれば、それらが export するシンボルを見る、そうでないならそもそもパッケージは探索しない\n- 一度ローカルファイルのどこかで import したパッケージのパスは、見る\n\nという感じ。",
  "createdAt": "Thu Dec 11 2025 10:57:21 GMT+0900 (日本標準時)",
  "updatedAt": "Thu Dec 11 2025 12:06:13 GMT+0900 (日本標準時)",
  "tags": [
    "scribble"
  ],
  "content": {
    "type": "root",
    "children": [
      {
        "type": "yaml",
        "value": "createdAt: 2025-12-11T10:57:21+09:00\nupdatedAt: 2025-12-11T12:06:13+09:00\ntags:\n  - scribble",
        "position": {
          "start": {
            "line": 1,
            "column": 1,
            "offset": 0
          },
          "end": {
            "line": 6,
            "column": 4,
            "offset": 100
          }
        }
      },
      {
        "type": "paragraph",
        "children": [
          {
            "type": "text",
            "value": "Ctrl + Space を押すと、書きかけの変数名や型名、関数名を良い感じに補完してくれるし、必要に応じて import 文も追加してくれて便利、くらいの認識でいたら、不可解な挙動に悩まされたのでメモ。",
            "position": {
              "start": {
                "line": 7,
                "column": 1,
                "offset": 101
              },
              "end": {
                "line": 7,
                "column": 103,
                "offset": 203
              }
            }
          }
        ],
        "position": {
          "start": {
            "line": 7,
            "column": 1,
            "offset": 101
          },
          "end": {
            "line": 7,
            "column": 103,
            "offset": 203
          }
        }
      },
      {
        "type": "paragraph",
        "children": [
          {
            "type": "text",
            "value": "あるプロジェクトで、dependencies に指定したパッケージから export されたシンボルが補完候補に出てこなくなった。",
            "position": {
              "start": {
                "line": 9,
                "column": 1,
                "offset": 205
              },
              "end": {
                "line": 9,
                "column": 66,
                "offset": 270
              }
            }
          }
        ],
        "position": {
          "start": {
            "line": 9,
            "column": 1,
            "offset": 205
          },
          "end": {
            "line": 9,
            "column": 66,
            "offset": 270
          }
        }
      },
      {
        "type": "list",
        "ordered": false,
        "start": null,
        "spread": false,
        "children": [
          {
            "type": "listItem",
            "spread": false,
            "checked": null,
            "children": [
              {
                "type": "paragraph",
                "children": [
                  {
                    "type": "text",
                    "value": "さっきまでは出ていたような気がする",
                    "position": {
                      "start": {
                        "line": 11,
                        "column": 3,
                        "offset": 274
                      },
                      "end": {
                        "line": 11,
                        "column": 20,
                        "offset": 291
                      }
                    }
                  }
                ],
                "position": {
                  "start": {
                    "line": 11,
                    "column": 3,
                    "offset": 274
                  },
                  "end": {
                    "line": 11,
                    "column": 20,
                    "offset": 291
                  }
                }
              }
            ],
            "position": {
              "start": {
                "line": 11,
                "column": 1,
                "offset": 272
              },
              "end": {
                "line": 11,
                "column": 20,
                "offset": 291
              }
            }
          },
          {
            "type": "listItem",
            "spread": false,
            "checked": null,
            "children": [
              {
                "type": "paragraph",
                "children": [
                  {
                    "type": "text",
                    "value": "ビルドは通るのでおそらく tsconfig の設定は合っていてい、あくまで IDE の問題",
                    "position": {
                      "start": {
                        "line": 12,
                        "column": 3,
                        "offset": 294
                      },
                      "end": {
                        "line": 12,
                        "column": 48,
                        "offset": 339
                      }
                    }
                  }
                ],
                "position": {
                  "start": {
                    "line": 12,
                    "column": 3,
                    "offset": 294
                  },
                  "end": {
                    "line": 12,
                    "column": 48,
                    "offset": 339
                  }
                }
              }
            ],
            "position": {
              "start": {
                "line": 12,
                "column": 1,
                "offset": 292
              },
              "end": {
                "line": 12,
                "column": 48,
                "offset": 339
              }
            }
          },
          {
            "type": "listItem",
            "spread": false,
            "checked": null,
            "children": [
              {
                "type": "paragraph",
                "children": [
                  {
                    "type": "text",
                    "value": "食い合わせ？の悪いパッケージのインストールしたのかと思って dependencies を増減させてみたが、特定できず",
                    "position": {
                      "start": {
                        "line": 13,
                        "column": 3,
                        "offset": 342
                      },
                      "end": {
                        "line": 13,
                        "column": 61,
                        "offset": 400
                      }
                    }
                  }
                ],
                "position": {
                  "start": {
                    "line": 13,
                    "column": 3,
                    "offset": 342
                  },
                  "end": {
                    "line": 13,
                    "column": 61,
                    "offset": 400
                  }
                }
              }
            ],
            "position": {
              "start": {
                "line": 13,
                "column": 1,
                "offset": 340
              },
              "end": {
                "line": 13,
                "column": 61,
                "offset": 400
              }
            }
          },
          {
            "type": "listItem",
            "spread": false,
            "checked": null,
            "children": [
              {
                "type": "paragraph",
                "children": [
                  {
                    "type": "text",
                    "value": "むしろ dependencies の数を減らすと補完として出現するようになるが、増やすと出なくなる",
                    "position": {
                      "start": {
                        "line": 14,
                        "column": 3,
                        "offset": 403
                      },
                      "end": {
                        "line": 14,
                        "column": 52,
                        "offset": 452
                      }
                    }
                  }
                ],
                "position": {
                  "start": {
                    "line": 14,
                    "column": 3,
                    "offset": 403
                  },
                  "end": {
                    "line": 14,
                    "column": 52,
                    "offset": 452
                  }
                }
              }
            ],
            "position": {
              "start": {
                "line": 14,
                "column": 1,
                "offset": 401
              },
              "end": {
                "line": 14,
                "column": 52,
                "offset": 452
              }
            }
          }
        ],
        "position": {
          "start": {
            "line": 11,
            "column": 1,
            "offset": 272
          },
          "end": {
            "line": 14,
            "column": 52,
            "offset": 452
          }
        }
      },
      {
        "type": "heading",
        "depth": 2,
        "children": [
          {
            "type": "text",
            "value": "原因",
            "position": {
              "start": {
                "line": 16,
                "column": 4,
                "offset": 457
              },
              "end": {
                "line": 16,
                "column": 6,
                "offset": 459
              }
            }
          }
        ],
        "position": {
          "start": {
            "line": 16,
            "column": 1,
            "offset": 454
          },
          "end": {
            "line": 16,
            "column": 6,
            "offset": 459
          }
        }
      },
      {
        "type": "paragraph",
        "children": [
          {
            "type": "text",
            "value": "コマンドパレットから ",
            "position": {
              "start": {
                "line": 18,
                "column": 1,
                "offset": 461
              },
              "end": {
                "line": 18,
                "column": 12,
                "offset": 472
              }
            }
          },
          {
            "type": "inlineCode",
            "value": "Open TS Server Log",
            "position": {
              "start": {
                "line": 18,
                "column": 12,
                "offset": 472
              },
              "end": {
                "line": 18,
                "column": 32,
                "offset": 492
              }
            }
          },
          {
            "type": "text",
            "value": " を実行してみると",
            "position": {
              "start": {
                "line": 18,
                "column": 32,
                "offset": 492
              },
              "end": {
                "line": 18,
                "column": 41,
                "offset": 501
              }
            }
          }
        ],
        "position": {
          "start": {
            "line": 18,
            "column": 1,
            "offset": 461
          },
          "end": {
            "line": 18,
            "column": 41,
            "offset": 501
          }
        }
      },
      {
        "type": "code",
        "lang": null,
        "meta": null,
        "value": "AutoImportProviderProject: attempted to add more than 10 dependencies. Aborting.",
        "position": {
          "start": {
            "line": 20,
            "column": 1,
            "offset": 503
          },
          "end": {
            "line": 22,
            "column": 4,
            "offset": 591
          }
        }
      },
      {
        "type": "paragraph",
        "children": [
          {
            "type": "text",
            "value": "とある。確かに、このログが出るときは補完が効かない、出ていないときは補完が効く。実際に dependencies の数にも一致していた。dependencies が 10 を超えると、パッケージが export するシンボルは auto import の対象から外れるもよう。",
            "position": {
              "start": {
                "line": 24,
                "column": 1,
                "offset": 593
              },
              "end": {
                "line": 24,
                "column": 139,
                "offset": 731
              }
            }
          }
        ],
        "position": {
          "start": {
            "line": 24,
            "column": 1,
            "offset": 593
          },
          "end": {
            "line": 24,
            "column": 139,
            "offset": 731
          }
        }
      },
      {
        "type": "heading",
        "depth": 2,
        "children": [
          {
            "type": "text",
            "value": "頭の整理",
            "position": {
              "start": {
                "line": 26,
                "column": 4,
                "offset": 736
              },
              "end": {
                "line": 26,
                "column": 8,
                "offset": 740
              }
            }
          }
        ],
        "position": {
          "start": {
            "line": 26,
            "column": 1,
            "offset": 733
          },
          "end": {
            "line": 26,
            "column": 8,
            "offset": 740
          }
        }
      },
      {
        "type": "paragraph",
        "children": [
          {
            "type": "text",
            "value": "原因が見えてきて、なんじゃこの仕様？　と思ったが、そもそもわたしに「補完」についての基本的な理解が欠けていたことに気づいた。",
            "position": {
              "start": {
                "line": 28,
                "column": 1,
                "offset": 742
              },
              "end": {
                "line": 28,
                "column": 63,
                "offset": 804
              }
            }
          }
        ],
        "position": {
          "start": {
            "line": 28,
            "column": 1,
            "offset": 742
          },
          "end": {
            "line": 28,
            "column": 63,
            "offset": 804
          }
        }
      },
      {
        "type": "paragraph",
        "children": [
          {
            "type": "text",
            "value": "まず素朴に考えるなら、補完はカーソルが当たっているコード上でのスコープで参照できるシンボルを出すのが基本。\nTypeScript であれば、",
            "position": {
              "start": {
                "line": 30,
                "column": 1,
                "offset": 806
              },
              "end": {
                "line": 31,
                "column": 17,
                "offset": 876
              }
            }
          }
        ],
        "position": {
          "start": {
            "line": 30,
            "column": 1,
            "offset": 806
          },
          "end": {
            "line": 31,
            "column": 17,
            "offset": 876
          }
        }
      },
      {
        "type": "list",
        "ordered": false,
        "start": null,
        "spread": false,
        "children": [
          {
            "type": "listItem",
            "spread": false,
            "checked": null,
            "children": [
              {
                "type": "paragraph",
                "children": [
                  {
                    "type": "text",
                    "value": "グローバルスコープのシンボル",
                    "position": {
                      "start": {
                        "line": 33,
                        "column": 3,
                        "offset": 880
                      },
                      "end": {
                        "line": 33,
                        "column": 17,
                        "offset": 894
                      }
                    }
                  }
                ],
                "position": {
                  "start": {
                    "line": 33,
                    "column": 3,
                    "offset": 880
                  },
                  "end": {
                    "line": 33,
                    "column": 17,
                    "offset": 894
                  }
                }
              }
            ],
            "position": {
              "start": {
                "line": 33,
                "column": 1,
                "offset": 878
              },
              "end": {
                "line": 33,
                "column": 17,
                "offset": 894
              }
            }
          },
          {
            "type": "listItem",
            "spread": false,
            "checked": null,
            "children": [
              {
                "type": "paragraph",
                "children": [
                  {
                    "type": "text",
                    "value": "そのファイル内のシンボル",
                    "position": {
                      "start": {
                        "line": 34,
                        "column": 3,
                        "offset": 897
                      },
                      "end": {
                        "line": 34,
                        "column": 15,
                        "offset": 909
                      }
                    }
                  }
                ],
                "position": {
                  "start": {
                    "line": 34,
                    "column": 3,
                    "offset": 897
                  },
                  "end": {
                    "line": 34,
                    "column": 15,
                    "offset": 909
                  }
                }
              }
            ],
            "position": {
              "start": {
                "line": 34,
                "column": 1,
                "offset": 895
              },
              "end": {
                "line": 34,
                "column": 15,
                "offset": 909
              }
            }
          },
          {
            "type": "listItem",
            "spread": false,
            "checked": null,
            "children": [
              {
                "type": "paragraph",
                "children": [
                  {
                    "type": "text",
                    "value": "そのファイル内で import したシンボル",
                    "position": {
                      "start": {
                        "line": 35,
                        "column": 3,
                        "offset": 912
                      },
                      "end": {
                        "line": 35,
                        "column": 25,
                        "offset": 934
                      }
                    }
                  }
                ],
                "position": {
                  "start": {
                    "line": 35,
                    "column": 3,
                    "offset": 912
                  },
                  "end": {
                    "line": 35,
                    "column": 25,
                    "offset": 934
                  }
                }
              }
            ],
            "position": {
              "start": {
                "line": 35,
                "column": 1,
                "offset": 910
              },
              "end": {
                "line": 35,
                "column": 25,
                "offset": 934
              }
            }
          }
        ],
        "position": {
          "start": {
            "line": 33,
            "column": 1,
            "offset": 878
          },
          "end": {
            "line": 35,
            "column": 25,
            "offset": 934
          }
        }
      },
      {
        "type": "paragraph",
        "children": [
          {
            "type": "text",
            "value": "あたりがまずは出てほしい。\nその意味では auto import という機能は「おまけ」に過ぎない。\nおまけの機能は、そもそも探索空間が膨大だから、どこかで割り切りをする必要がある。その恣意的なラインとして 10 というマジックナンバーがあるのは不思議ではない。",
            "position": {
              "start": {
                "line": 37,
                "column": 1,
                "offset": 936
              },
              "end": {
                "line": 39,
                "column": 81,
                "offset": 1067
              }
            }
          }
        ],
        "position": {
          "start": {
            "line": 37,
            "column": 1,
            "offset": 936
          },
          "end": {
            "line": 39,
            "column": 81,
            "offset": 1067
          }
        }
      },
      {
        "type": "paragraph",
        "children": [
          {
            "type": "text",
            "value": "実装を確認したわけではなくあくまで観測した挙動レベルでの整理だと、探索の範囲は",
            "position": {
              "start": {
                "line": 41,
                "column": 1,
                "offset": 1069
              },
              "end": {
                "line": 41,
                "column": 40,
                "offset": 1108
              }
            }
          }
        ],
        "position": {
          "start": {
            "line": 41,
            "column": 1,
            "offset": 1069
          },
          "end": {
            "line": 41,
            "column": 40,
            "offset": 1108
          }
        }
      },
      {
        "type": "list",
        "ordered": false,
        "start": null,
        "spread": false,
        "children": [
          {
            "type": "listItem",
            "spread": false,
            "checked": null,
            "children": [
              {
                "type": "paragraph",
                "children": [
                  {
                    "type": "text",
                    "value": "ローカルファイル（プロジェクト）のシンボルは全て見る",
                    "position": {
                      "start": {
                        "line": 43,
                        "column": 3,
                        "offset": 1112
                      },
                      "end": {
                        "line": 43,
                        "column": 29,
                        "offset": 1138
                      }
                    }
                  }
                ],
                "position": {
                  "start": {
                    "line": 43,
                    "column": 3,
                    "offset": 1112
                  },
                  "end": {
                    "line": 43,
                    "column": 29,
                    "offset": 1138
                  }
                }
              }
            ],
            "position": {
              "start": {
                "line": 43,
                "column": 1,
                "offset": 1110
              },
              "end": {
                "line": 43,
                "column": 29,
                "offset": 1138
              }
            }
          },
          {
            "type": "listItem",
            "spread": false,
            "checked": null,
            "children": [
              {
                "type": "paragraph",
                "children": [
                  {
                    "type": "text",
                    "value": "dependencies に書いたパッケージが 10 以下であれば、それらが export するシンボルを見る、そうでないならそもそもパッケージは探索しない",
                    "position": {
                      "start": {
                        "line": 44,
                        "column": 3,
                        "offset": 1141
                      },
                      "end": {
                        "line": 44,
                        "column": 81,
                        "offset": 1219
                      }
                    }
                  }
                ],
                "position": {
                  "start": {
                    "line": 44,
                    "column": 3,
                    "offset": 1141
                  },
                  "end": {
                    "line": 44,
                    "column": 81,
                    "offset": 1219
                  }
                }
              }
            ],
            "position": {
              "start": {
                "line": 44,
                "column": 1,
                "offset": 1139
              },
              "end": {
                "line": 44,
                "column": 81,
                "offset": 1219
              }
            }
          },
          {
            "type": "listItem",
            "spread": false,
            "checked": null,
            "children": [
              {
                "type": "paragraph",
                "children": [
                  {
                    "type": "text",
                    "value": "一度ローカルファイルのどこかで import したパッケージのパスは、見る",
                    "position": {
                      "start": {
                        "line": 45,
                        "column": 3,
                        "offset": 1222
                      },
                      "end": {
                        "line": 45,
                        "column": 40,
                        "offset": 1259
                      }
                    }
                  }
                ],
                "position": {
                  "start": {
                    "line": 45,
                    "column": 3,
                    "offset": 1222
                  },
                  "end": {
                    "line": 45,
                    "column": 40,
                    "offset": 1259
                  }
                }
              }
            ],
            "position": {
              "start": {
                "line": 45,
                "column": 1,
                "offset": 1220
              },
              "end": {
                "line": 45,
                "column": 40,
                "offset": 1259
              }
            }
          }
        ],
        "position": {
          "start": {
            "line": 43,
            "column": 1,
            "offset": 1110
          },
          "end": {
            "line": 45,
            "column": 40,
            "offset": 1259
          }
        }
      },
      {
        "type": "paragraph",
        "children": [
          {
            "type": "text",
            "value": "という感じ。",
            "position": {
              "start": {
                "line": 47,
                "column": 1,
                "offset": 1261
              },
              "end": {
                "line": 47,
                "column": 7,
                "offset": 1267
              }
            }
          }
        ],
        "position": {
          "start": {
            "line": 47,
            "column": 1,
            "offset": 1261
          },
          "end": {
            "line": 47,
            "column": 7,
            "offset": 1267
          }
        }
      }
    ],
    "position": {
      "start": {
        "line": 1,
        "column": 1,
        "offset": 0
      },
      "end": {
        "line": 47,
        "column": 7,
        "offset": 1267
      }
    }
  }
}